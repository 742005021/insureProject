<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>理赔申请</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}"/>
    <script th:src="@{/js/jquery-1.11.0.min.js}"></script>
    <style>
        #body .full{
            width:100%;
        }
    </style>
</head>
<body id="body">

    <div class="container" style="padding:0px;">

        <form class="form-horizontal" action="/report/insert" method="post" id="form">
            <div class="form-group form-inline">
                <label for="insured_name" class="col-sm-1 control-label">被保人姓名</label>
                <p class="col-sm-2">
                    <input type="text" class="form-control full" id="insured_name" name="insured_name">
                </p>

                <label for="insured_sex" class="col-sm-1 control-label">性别</label>
                <p class="col-sm-2">
                    <select class="form-control full" id="insured_sex" name="insured_sex">
                        <option value="男">男</option>
                        <option value="女">女</option>
                    </select>
                </p>

                <label for="insured_age" class="col-sm-1 control-label">年龄</label>
                <p class="col-sm-2">
                    <input type="number" value="18" min="0" max="120" class="form-control full" id="insured_age" name="insured_age">
                </p>

                <label for="insured_crad_id" class="col-sm-1 control-label">身份证号码</label>
                <p class="col-sm-2">
                    <input type="text" class="form-control full" id="insured_crad_id" name="insured_crad_id">
                </p>
            </div>

            <div class="form-group form-inline" >
                <label for="cr_enterprise" class="col-sm-1 control-label">单位名称</label>
                <p class="col-sm-5">
                    <input type="text" class="form-control full" id="cr_enterprise" name="cr_enterprise">
                </p>

                <label for="insured_profession" class="col-sm-1 control-label">职业</label>
                <p class="col-sm-5">
                    <input type="text" class="form-control full" id="insured_profession" name="insured_profession">
                </p>

            </div>

            <div class="form-group form-inline">
                <label for="accident_date" class="col-sm-1 control-label">事故日期</label>
                <p class="col-sm-2">
                    <input type="text" class="form-control full" id="accident_date" name="accident_date">
                </p>

                <label for="accident_cause" class="col-sm-1 control-label">原因</label>
                <p class="col-sm-2">
                    <input type="text" class="form-control full" id="accident_cause" name="accident_cause">
                </p>

                <label for="accident_address" class="col-sm-1 control-label">地点</label>
                <p class="col-sm-2">
                    <input type="text" class="form-control full" id="accident_address" name="accident_address">
                </p>

                <label for="situation" class="col-sm-1 control-label">现状</label>
                <p class="col-sm-2">
                    <input type="text" class="form-control full" id="situation" name="situation">
                </p>
            </div>

            <div class="form-group form-inline">
                <label for="things" class="col-sm-1 control-label">事故经过（详细填写）</label>
                <p class="col-sm-11">
                    <textarea class="form-control full" id="things" name="things" rows="3"></textarea>
                    <!--<input type="text" class="form-control full" id="things" name="things">-->
                </p>
            </div>

            <div class="form-group form-inline">
                <label for="is_death" class="col-sm-1 control-label">是否身故</label>
                <p class="col-sm-2">
                    <select class="form-control full" id="is_death">
                        <option value="true">是</option>
                        <option value="false" selected>否</option>
                    </select>
                </p>

                <label for="autopsy" class="col-sm-1 control-label">是否已检验死因</label>
                <p class="col-sm-2">
                    <select class="form-control full" name="autopsy" id="autopsy" disabled>
                        <option value="true">是（请附证明材料）</option>
                        <option value="false" selected>否</option>
                    </select>
                </p>

                <label for="deathcertificate" class="col-sm-2 control-label">死亡证明文件</label>
                <p class="col-sm-4">
                    <input type="file" id="deathcertificate" name="deathcertificate" class="form-control full" disabled/>
                </p>
            </div>

            <div class="form-group form-inline">
                <label for="cr_name" class="col-sm-1 control-label">申请人姓名</label>
                <p class="col-sm-3">
                    <input type="text" id="cr_name" name="cr_name" class="form-control full"/>
                </p>

                <label for="cr_relationship" class="col-sm-1 control-label">与被保人关系</label>
                <p class="col-sm-3">
                    <select id="cr_relationship" name="cr_relationship" class="form-control full">
                        <option value="" selected>请选择</option>
                        <option value="本人">本人</option>
                        <option value="朋友">朋友</option>
                        <option value="家属">家属</option>
                    </select>
                </p>

                <label for="cr_phone" class="col-sm-1 control-label">联系电话</label>
                <p class="col-sm-3">
                    <input type="text" id="cr_phone" name="cr_phone" class="form-control full"/>
                </p>
            </div>

            <div class="form-group form-inline">
                <label for="cr_policy_id" class="col-sm-1 control-label">保单号</label>
                <p class="col-sm-5">
                    <input type="text" id="cr_policy_id" name="cr_policy_id" class="form-control full"/>
                </p>

                <label for="payment" class="col-sm-1 control-label">领保方式</label>
                <p class="col-sm-5">
                    <select class="form-control full" name="payment" id="payment">
                        <option value="1" selected>1.银行转账</option>
                        <option value="2">2.委托（单位/个人）</option>
                        <option value="3">3.自领</option>
                    </select>
                </p>
            </div>

            <div class="form-group form-inline">
                <label for="bank_name" class="col-sm-1 control-label">开户银行</label>
                <p class="col-sm-5">
                    <input type="text" id="bank_name" name="bank_name" class="form-control full"/>
                </p>

                <!--<label for="account_name" class="col-sm-1 control-label">户名（限申请者本人）</label>-->
                <!--<p class="col-sm-3">-->
                    <!--<input type="text" id="account_name" name="account_name" class="form-control full" />-->
                <!--</p>-->

                <label for="bank_no" class="col-sm-1 control-label">账号</label>
                <p class="col-sm-5">
                    <input type="text" id="bank_no" name="bank_no" class="form-control full"/>
                </p>
            </div>

            <div class="form-group form-inline">
                <label for="notice_address" class="col-sm-1 control-label">理赔通知送达地址</label>
                <p class="col-sm-5">
                    <input type="text" id="notice_address" name="notice_address" class="form-control full"/>
                </p>

                <label for="post_code" class="col-sm-1 control-label">邮编</label>
                <p class="col-sm-5">
                    <input type="text" id="post_code" name="post_code" class="form-control full"/>
                </p>
            </div>
        </form>

        <div class="form-group form-inline">
            <p class="col-sm-offset-1 col-sm-11">
                <button class="btn btn-info btn-block" id="btn">提交</button>
            </p>
        </div>
    </div>

    <script type="text/javascript">
        //是否死亡
        $("#is_death").change(function(){
            if($(this).val()=="true"){
                $('#autopsy').attr("disabled",false);
            }else{
                $('#autopsy').val("false");
                $('#autopsy').attr("disabled",true);
                $('#deathcertificate').attr("disabled",true);
            }
        });

        //是否检验死亡
        $("#autopsy").change(function(){
            $('#deathcertificate').attr("disabled",$(this).val()=="false");
        })

        $("#btn").click(function(){
            if(check()){
                $("#btn").attr("disabled",true);
                $.ajax({
                    url:"/report_policy_check/"+$("#cr_policy_id").val(),
                    type:"post",
                    dataType:"json",
                    success:function(data){
                        if(data*1){
                            $("#form").submit();//提交
                        }else{
                            alert("表单信息不存在!\n请检查您输入的保单号!");
                            $("#btn").attr("disabled",false);
                        }
                    }
                });
            }else{
                alert("请将表单填写完整!");
            }
        })

        function check(){
            var b=true;
            //检查文本输出框
            $("#form input[type=text]").each(function(i,e){
                console.log(i);
                if($(e).val()=="")
                    return b=false;
            });
            if(!b){
                return b;
            }

            b=$("#things").val()!="";
            if(!b) return b;

            if($('#autopsy').val()=="true" && !$('#deathcertificate').prop("disabled") ){
                if($("#deathcertificate").val()==""){
                    alert("请提交死亡证明文件!");
                    $("#deathcertificate").focus();
                    return false;
                }
            }

            b=$("#cr_relationship").val()!="";
            if(!b) return b;

            return true;
        }
    </script>
</body>
</html>